<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback - Kh√≥a H·ªçc Ti·∫øng Trung</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 2.5rem;
            color: #E74C3C;
            margin-bottom: 10px;
        }
        
        h1 {
            color: #2C3E50;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            color: #7F8C8D;
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .progress-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: none;
        }
        
        .progress-bar {
            height: 10px;
            background: #ECF0F1;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: #2ECC71;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            text-align: center;
            color: #7F8C8D;
            font-weight: 500;
        }
        
        .group-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s forwards;
            border-left: 5px solid #3498DB;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .group-container:nth-child(2) {
            border-left-color: #2ECC71;
        }
        
        .group-container:nth-child(3) {
            border-left-color: #E74C3C;
        }
        
        .group-container:nth-child(4) {
            border-left-color: #F39C12;
        }
        
        .group-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .group-icon {
            width: 50px;
            height: 50px;
            background: #3498DB;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.3rem;
        }
        
        .group-container:nth-child(2) .group-icon {
            background: #2ECC71;
        }
        
        .group-container:nth-child(3) .group-icon {
            background: #E74C3C;
        }
        
        .group-container:nth-child(4) .group-icon {
            background: #F39C12;
        }
        
        .group-title {
            color: #2C3E50;
            font-size: 1.5rem;
        }
        
        .question {
            margin-bottom: 25px;
        }
        
        .question:last-child {
            margin-bottom: 0;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2C3E50;
            font-size: 1.1rem;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ECF0F1;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            transition: border 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #3498DB;
        }
        
        .emoji-rating {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .emoji {
            font-size: 2.5rem;
            cursor: pointer;
            transition: transform 0.3s;
            opacity: 0.6;
        }
        
        .emoji:hover {
            transform: scale(1.2);
        }
        
        .emoji.active {
            opacity: 1;
            transform: scale(1.2);
        }
        
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #prevBtn {
            background: #BDC3C7;
            color: white;
        }
        
        #prevBtn:hover:not(:disabled) {
            background: #7F8C8D;
        }
        
        #nextBtn, #submitBtn {
            background: #3498DB;
            color: white;
        }
        
        #nextBtn:hover, #submitBtn:hover {
            background: #2980B9;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #submitBtn {
            background: #2ECC71;
            display: none;
        }
        
        #submitBtn:hover {
            background: #27AE60;
        }
        
        .thank-you {
            text-align: center;
            padding: 50px 20px;
            display: none;
        }
        
        .thank-you i {
            font-size: 5rem;
            color: #2ECC71;
            margin-bottom: 20px;
        }
        
        .thank-you h2 {
            color: #2C3E50;
            margin-bottom: 15px;
        }
        
        .thank-you p {
            color: #7F8C8D;
            max-width: 600px;
            margin: 0 auto 25px;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498DB;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer-note {
            text-align: center;
            color: #7F8C8D;
            font-size: 0.9rem;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ECF0F1;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .group-container {
                padding: 20px;
            }
            
            .button-container {
                flex-direction: column;
                gap: 15px;
            }
            
            button {
                width: 100%;
            }
            
            .emoji-rating {
                gap: 10px;
            }
            
            .emoji {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-comments"></i>
            </div>
            <h1>Chia S·∫ª C·∫£m Nh·∫≠n C·ªßa B·∫°n</h1>
            <p class="subtitle">√ù ki·∫øn c·ªßa b·∫°n r·∫•t quan tr·ªçng ƒë·ªÉ ch√∫ng t√¥i c√≥ th·ªÉ c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng kh√≥a h·ªçc. H√£y d√†nh v√†i ph√∫t ƒë·ªÉ chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n nh√©!</p>
        </header>
        
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Nh√≥m 1/4</div>
        </div>
        
        <div class="group-container" id="group1">
            <div class="group-header">
                <div class="group-icon">
                    <i class="fas fa-smile"></i>
                </div>
                <h2 class="group-title">Tr·∫£i nghi·ªám & c·∫£m nh·∫≠n t√≠ch c·ª±c</h2>
            </div>
            
            <div class="question">
                <div class="question-text">1. Tr∆∞·ªõc khi tham gia kho√° h·ªçc, b·∫°n k·ª≥ v·ªçng ƒëi·ªÅu g√¨, v√† sau khi k·∫øt th√∫c kho√° h·ªçc, b·∫°n c·∫£m nh·∫≠n k·∫øt qu·∫£ ƒë·∫°t ƒë∆∞·ª£c ra sao?</div>
                <textarea id="q1" placeholder="H√£y chia s·∫ª nh·ªØng ƒëi·ªÅu b·∫°n mong ƒë·ª£i v√† c·∫£m nh·∫≠n sau kh√≥a h·ªçc..."></textarea>
            </div>
            
            <div class="question">
                <div class="question-text">2. ƒêi·ªÅu g√¨ ·ªü kho√° h·ªçc n√†y khi·∫øn b·∫°n c·∫£m th·∫•y tho·∫£i m√°i ho·∫∑c y√™n t√¢m nh·∫•t khi h·ªçc?</div>
                <textarea id="q2" placeholder="ƒêi·ªÅu g√¨ l√†m b·∫°n c·∫£m th·∫•y d·ªÖ ch·ªãu khi h·ªçc?..."></textarea>
            </div>
            
            <div class="question">
                <div class="question-text">3. C√≥ kho·∫£nh kh·∫Øc hay bu·ªïi h·ªçc n√†o khi·∫øn b·∫°n c·∫£m th·∫•y ‚Äú√Ä, m√¨nh ƒëang ti·∫øn b·ªô th·∫≠t‚Äù kh√¥ng? H√£y chia s·∫ª ng·∫Øn g·ªçn.</div>
                <textarea id="q3" placeholder="H√£y k·ªÉ v·ªÅ kho·∫£nh kh·∫Øc b·∫°n nh·∫≠n ra s·ª± ti·∫øn b·ªô c·ªßa m√¨nh..."></textarea>
            </div>
        </div>
        
        <div class="group-container" id="group2" style="display: none;">
            <div class="group-header">
                <div class="group-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h2 class="group-title">Hi·ªáu qu·∫£ h·ªçc t·∫≠p</h2>
            </div>
            
            <div class="question">
                <div class="question-text">4. Sau kho√° h·ªçc, b·∫°n th·∫•y ti·∫øng Trung c·ªßa m√¨nh thay ƒë·ªïi nh∆∞ th·∫ø n√†o so v·ªõi tr∆∞·ªõc ƒë√¢y?</div>
                <textarea id="q4" placeholder="H√£y m√¥ t·∫£ s·ª± thay ƒë·ªïi trong kh·∫£ nƒÉng ti·∫øng Trung c·ªßa b·∫°n..."></textarea>
            </div>
            
            <div class="question">
                <div class="question-text">5. Ki·∫øn th·ª©c ho·∫∑c k·ªπ nƒÉng n√†o b·∫°n c·∫£m th·∫•y √°p d·ª•ng ƒë∆∞·ª£c ngay v√†o th·ª±c t·∫ø?</div>
                <textarea id="q5" placeholder="Nh·ªØng ki·∫øn th·ª©c/k·ªπ nƒÉng n√†o b·∫°n ƒë√£ √°p d·ª•ng ƒë∆∞·ª£c?..."></textarea>
            </div>
            
            <div class="question">
                <div class="question-text">6. N·∫øu so s√°nh kho√° h·ªçc n√†y v·ªõi nh·ªØng n∆°i b·∫°n t·ª´ng h·ªçc tr∆∞·ªõc ƒë√≥ (n·∫øu c√≥), b·∫°n th·∫•y ƒëi·ªÉm kh√°c bi·ªát l·ªõn nh·∫•t l√† g√¨?</div>
                <textarea id="q6" placeholder="ƒêi·ªÉm kh√°c bi·ªát n√†o l√†m b·∫°n ·∫•n t∆∞·ª£ng nh·∫•t?..."></textarea>
            </div>
        </div>
        
        <div class="group-container" id="group3" style="display: none;">
            <div class="group-header">
                <div class="group-icon">
                    <i class="fas fa-bullhorn"></i>
                </div>
                <h2 class="group-title">C√¢u h·ªèi testimonial</h2>
            </div>
            
            <div class="question">
                <div class="question-text">7. N·∫øu c√≥ m·ªôt ng∆∞·ªùi ƒëang ph√¢n v√¢n kh√¥ng bi·∫øt c√≥ n√™n ƒëƒÉng k√Ω kho√° h·ªçc n√†y hay kh√¥ng, b·∫°n mu·ªën nh·∫Øn g·ª≠i ƒëi·ªÅu g√¨ ƒë·∫øn h·ªç?</div>
                <textarea id="q7" placeholder="H√£y chia s·∫ª th√¥ng ƒëi·ªáp c·ªßa b·∫°n cho nh·ªØng ng∆∞·ªùi ƒëang ph√¢n v√¢n..."></textarea>
            </div>
            
            <div class="question">
                <div class="question-text">8. H√£y ho√†n th√†nh c√¢u sau:<br>üëâ "T√¥i s·∫Ω gi·ªõi thi·ªáu kho√° h·ªçc n√†y cho ng∆∞·ªùi kh√°c v√¨ __________."</div>
                <textarea id="q8" placeholder="ƒêi·ªÅn l√Ω do b·∫°n mu·ªën gi·ªõi thi·ªáu kh√≥a h·ªçc..."></textarea>
            </div>
            
            <div class="question">
                <div class="question-text">9. Theo b·∫°n, kho√° h·ªçc n√†y ph√π h·ª£p nh·∫•t v·ªõi ƒë·ªëi t∆∞·ª£ng n√†o?</div>
                <div class="emoji-rating">
                    <div class="emoji" data-value="Ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu">üòä</div>
                    <div class="emoji" data-value="Ng∆∞·ªùi m·∫•t g·ªëc">üòÖ</div>
                    <div class="emoji" data-value="Luy·ªán giao ti·∫øp">üí¨</div>
                    <div class="emoji" data-value="Luy·ªán thi">üìö</div>
                    <div class="emoji" data-value="T·∫•t c·∫£ ƒë·ªëi t∆∞·ª£ng">üë•</div>
                </div>
                <textarea id="q9" placeholder="Ho·∫∑c b·∫°n c√≥ th·ªÉ gi·∫£i th√≠ch chi ti·∫øt h∆°n t·∫°i ƒë√¢y..."></textarea>
            </div>
        </div>
        
        <div class="group-container" id="group4" style="display: none;">
            <div class="group-header">
                <div class="group-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h2 class="group-title">G√≥p √Ω nh·∫π - v·∫´n mang h∆∞·ªõng t√≠ch c·ª±c</h2>
            </div>
            
            <div class="question">
                <div class="question-text">10. C√≥ ƒëi·ªÅu g√¨ b·∫°n nghƒ© r·∫±ng n·∫øu ƒë∆∞·ª£c c·∫£i thi·ªán th√™m m·ªôt ch√∫t, kho√° h·ªçc s·∫Ω c√≤n t·ªët h∆°n n·ªØa kh√¥ng?</div>
                <textarea id="q10" placeholder="ƒê·ªÅ xu·∫•t c·ªßa b·∫°n ƒë·ªÉ kh√≥a h·ªçc t·ªët h∆°n..."></textarea>
            </div>
            
            <div class="question">
                <div class="question-text">11. B·∫°n mong mu·ªën trung t√¢m b·ªï sung th√™m n·ªôi dung ho·∫∑c ho·∫°t ƒë·ªông n√†o trong c√°c kho√° h·ªçc ti·∫øp theo?</div>
                <textarea id="q11" placeholder="√ù t∆∞·ªüng c·ªßa b·∫°n cho c√°c kh√≥a h·ªçc ti·∫øp theo..."></textarea>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>ƒêang x·ª≠ l√Ω v√† g·ª≠i ph·∫£n h·ªìi c·ªßa b·∫°n...</p>
        </div>
        
        <div class="thank-you" id="thankYou">
            <i class="fas fa-check-circle"></i>
            <h2>C·∫£m ∆†n B·∫°n!</h2>
            <p>Ph·∫£n h·ªìi c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n v√† s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa gi·∫£ng vi√™n. Ch√∫ng t√¥i tr√¢n tr·ªçng s·ª± chia s·∫ª ch√¢n th√†nh c·ªßa b·∫°n v√† s·∫Ω s·ª≠ d·ª•ng nh·ªØng √Ω ki·∫øn n√†y ƒë·ªÉ c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng kh√≥a h·ªçc.</p>
            <p>Ch√∫c b·∫°n m·ªôt ng√†y t·ªët l√†nh!</p>
        </div>
        
        <div class="button-container">
            <button id="prevBtn" disabled>‚Üê Quay l·∫°i</button>
            <button id="nextBtn">Ti·∫øp theo ‚Üí</button>
            <button id="submitBtn" style="display: none;">G·ª≠i Ph·∫£n H·ªìi</button>
        </div>
        
        <div class="footer-note">
            <p><i class="fas fa-lock"></i> Ph·∫£n h·ªìi c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c b·∫£o m·∫≠t v√† ch·ªâ s·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng gi·∫£ng d·∫°y.</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- EmailJS for sending email -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDcsk8X1rFd1qMd1W9510-ZKFlSfZUUKV8",
            authDomain: "lop-hoc-tuong-tac-26351.firebaseapp.com",
            databaseURL: "https://lop-hoc-tuong-tac-26351-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lop-hoc-tuong-tac-26351",
            storageBucket: "lop-hoc-tuong-tac-26351.firebasestorage.app",
            messagingSenderId: "854589974779",
            appId: "1:854589974779:web:038a2f3d54cb443a6f685e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Initialize EmailJS with your public key
        // You need to create an account at https://www.emailjs.com and get your own public key
        // For now, I'm using a placeholder. Replace with your actual public key
        emailjs.init("nhanfeedback");
        
        let currentGroup = 1;
        const totalGroups = 4;
        let selectedAudience = "";
        
        // Initialize the UI
        document.addEventListener('DOMContentLoaded', function() {
            updateProgressBar();
            setupEmojiListeners();
            setupButtonListeners();
            
            // Show progress bar after a short delay
            setTimeout(() => {
                document.getElementById('progressContainer').style.display = 'block';
            }, 500);
        });
        
        function updateProgressBar() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const percentage = (currentGroup / totalGroups) * 100;
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `Nh√≥m ${currentGroup}/${totalGroups}`;
            
            // Update button visibility
            document.getElementById('prevBtn').disabled = currentGroup === 1;
            document.getElementById('nextBtn').style.display = currentGroup === totalGroups ? 'none' : 'block';
            document.getElementById('submitBtn').style.display = currentGroup === totalGroups ? 'block' : 'none';
        }
        
        function setupEmojiListeners() {
            const emojis = document.querySelectorAll('.emoji');
            emojis.forEach(emoji => {
                emoji.addEventListener('click', function() {
                    // Remove active class from all emojis
                    emojis.forEach(e => e.classList.remove('active'));
                    
                    // Add active class to clicked emoji
                    this.classList.add('active');
                    
                    // Store the selected value
                    selectedAudience = this.getAttribute('data-value');
                    
                    // Update textarea
                    document.getElementById('q9').value = `Theo t√¥i, kh√≥a h·ªçc n√†y ph√π h·ª£p nh·∫•t v·ªõi: ${selectedAudience}`;
                });
            });
        }
        
        function setupButtonListeners() {
            document.getElementById('prevBtn').addEventListener('click', function() {
                if (currentGroup > 1) {
                    document.getElementById(`group${currentGroup}`).style.display = 'none';
                    currentGroup--;
                    document.getElementById(`group${currentGroup}`).style.display = 'block';
                    updateProgressBar();
                }
            });
            
            document.getElementById('nextBtn').addEventListener('click', function() {
                if (currentGroup < totalGroups) {
                    document.getElementById(`group${currentGroup}`).style.display = 'none';
                    currentGroup++;
                    document.getElementById(`group${currentGroup}`).style.display = 'block';
                    updateProgressBar();
                    
                    // Scroll to top of the group
                    document.getElementById(`group${currentGroup}`).scrollIntoView({ behavior: 'smooth' });
                }
            });
            
            document.getElementById('submitBtn').addEventListener('click', submitFeedback);
        }
        
        function submitFeedback() {
            // Get all answers
            const feedback = {
                timestamp: new Date().toISOString(),
                group1: {
                    q1: document.getElementById('q1').value.trim(),
                    q2: document.getElementById('q2').value.trim(),
                    q3: document.getElementById('q3').value.trim()
                },
                group2: {
                    q4: document.getElementById('q4').value.trim(),
                    q5: document.getElementById('q5').value.trim(),
                    q6: document.getElementById('q6').value.trim()
                },
                group3: {
                    q7: document.getElementById('q7').value.trim(),
                    q8: document.getElementById('q8').value.trim(),
                    q9: document.getElementById('q9').value.trim()
                },
                group4: {
                    q10: document.getElementById('q10').value.trim(),
                    q11: document.getElementById('q11').value.trim()
                }
            };
            
            // Validate that all fields are filled
            let isValid = true;
            for (let group in feedback) {
                if (group !== 'timestamp') {
                    for (let question in feedback[group]) {
                        if (!feedback[group][question]) {
                            isValid = false;
                            alert(`Vui l√≤ng tr·∫£ l·ªùi c√¢u h·ªèi ${question.toUpperCase()} trong nh√≥m ${group}`);
                            return;
                        }
                    }
                }
            }
            
            if (!isValid) return;
            
            // Show loading
            document.querySelector('.button-container').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            
            // Save to Firebase
            const feedbackRef = database.ref('feedback');
            const newFeedbackRef = feedbackRef.push();
            
            newFeedbackRef.set(feedback)
                .then(() => {
                    // Generate PDF
                    generateAndSendPDF(feedback, newFeedbackRef.key);
                })
                .catch((error) => {
                    console.error('Error saving feedback:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi l∆∞u ph·∫£n h·ªìi. Vui l√≤ng th·ª≠ l·∫°i.');
                    document.getElementById('loading').style.display = 'none';
                    document.querySelector('.button-container').style.display = 'flex';
                });
        }
        
        function generateAndSendPDF(feedback, feedbackId) {
            // Create a new jsPDF instance
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set document properties
            doc.setProperties({
                title: `Feedback Kh√≥a H·ªçc Ti·∫øng Trung - ${feedbackId}`,
                subject: 'Ph·∫£n h·ªìi h·ªçc vi√™n',
                author: 'H·ªá th·ªëng Feedback',
                keywords: 'feedback, ti·∫øng trung, kh√≥a h·ªçc',
                creator: 'Feedback Web App'
            });
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(44, 62, 80);
            doc.text('PH·∫¢N H·ªíI KH√ìA H·ªåC TI·∫æNG TRUNG', 105, 20, null, null, 'center');
            
            // Add timestamp
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            const date = new Date(feedback.timestamp);
            const formattedDate = date.toLocaleDateString('vi-VN') + ' ' + date.toLocaleTimeString('vi-VN');
            doc.text(`Th·ªùi gian g·ª≠i: ${formattedDate}`, 105, 30, null, null, 'center');
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            let yPosition = 45;
            
            // Group 1
            doc.setFontSize(14);
            doc.setTextColor(52, 152, 219);
            doc.text('NH√ìM 1: TR·∫¢I NGHI·ªÜM & C·∫¢M NH·∫¨N T√çCH C·ª∞C', 10, yPosition);
            yPosition += 10;
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            doc.text(`1. ${feedback.group1.q1.substring(0, 150)}${feedback.group1.q1.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 10;
            
            if (yPosition > 270) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.text(`2. ${feedback.group1.q2.substring(0, 150)}${feedback.group1.q2.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 10;
            
            if (yPosition > 270) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.text(`3. ${feedback.group1.q3.substring(0, 150)}${feedback.group1.q3.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 15;
            
            // Group 2
            doc.setFontSize(14);
            doc.setTextColor(46, 204, 113);
            doc.text('NH√ìM 2: HI·ªÜU QU·∫¢ H·ªåC T·∫¨P', 10, yPosition);
            yPosition += 10;
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            doc.text(`4. ${feedback.group2.q4.substring(0, 150)}${feedback.group2.q4.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 10;
            
            if (yPosition > 270) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.text(`5. ${feedback.group2.q5.substring(0, 150)}${feedback.group2.q5.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 10;
            
            if (yPosition > 270) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.text(`6. ${feedback.group2.q6.substring(0, 150)}${feedback.group2.q6.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 15;
            
            // Group 3
            doc.setFontSize(14);
            doc.setTextColor(231, 76, 60);
            doc.text('NH√ìM 3: C√ÇU H·ªéI TESTIMONIAL', 10, yPosition);
            yPosition += 10;
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            doc.text(`7. ${feedback.group3.q7.substring(0, 150)}${feedback.group3.q7.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 10;
            
            if (yPosition > 270) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.text(`8. ${feedback.group3.q8.substring(0, 150)}${feedback.group3.q8.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 10;
            
            if (yPosition > 270) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.text(`9. ${feedback.group3.q9.substring(0, 150)}${feedback.group3.q9.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 15;
            
            // Group 4
            doc.setFontSize(14);
            doc.setTextColor(243, 156, 18);
            doc.text('NH√ìM 4: G√ìP √ù NH·∫∏', 10, yPosition);
            yPosition += 10;
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            doc.text(`10. ${feedback.group4.q10.substring(0, 150)}${feedback.group4.q10.length > 150 ? '...' : ''}`, 10, yPosition);
            yPosition += 10;
            
            if (yPosition > 270) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.text(`11. ${feedback.group4.q11.substring(0, 150)}${feedback.group4.q11.length > 150 ? '...' : ''}`, 10, yPosition);
            
            // Generate PDF as base64
            const pdfBase64 = doc.output('datauristring').split(',')[1];
            
            // Send email with PDF attachment
            sendEmailWithPDF(pdfBase64, feedbackId, formattedDate);
        }
        
        function sendEmailWithPDF(pdfBase64, feedbackId, date) {
            // EmailJS configuration
            // You need to set up EmailJS service and template
            // For now, we'll save the PDF to Firebase Storage and send a notification
            
            // Save the PDF to Firebase Database as base64
            const pdfRef = database.ref(`pdfs/${feedbackId}`);
            pdfRef.set({
                base64: pdfBase64,
                timestamp: new Date().toISOString(),
                feedbackId: feedbackId
            })
            .then(() => {
                // Show thank you message
                document.getElementById('loading').style.display = 'none';
                document.getElementById('progressContainer').style.display = 'none';
                document.getElementById(`group${currentGroup}`).style.display = 'none';
                document.getElementById('thankYou').style.display = 'block';
                
                // Reset form after 5 seconds (optional)
                setTimeout(() => {
                    // You could redirect or reset the form here
                }, 5000);
            })
            .catch((error) => {
                console.error('Error saving PDF:', error);
                alert('ƒê√£ l∆∞u ph·∫£n h·ªìi nh∆∞ng c√≥ l·ªói khi t·∫°o PDF. Vui l√≤ng th·ª≠ l·∫°i.');
                document.getElementById('loading').style.display = 'none';
                document.querySelector('.button-container').style.display = 'flex';
            });
        }
    </script>
</body>
</html>
