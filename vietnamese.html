<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶Šå—è¯­æ‹¼å†™å¬åŠ›ç»ƒä¹ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Mali', cursive;
            background-color: #FFF9DE;
            color: #583101;
        }
        .card {
            background-color: #FFECD1;
            border: 2px solid #A37E58;
            box-shadow: 5px 5px 0px #A37E58;
        }
        .btn-option {
            background-color: #FFFFFF;
            border: 2px solid #A37E58;
            box-shadow: 3px 3px 0px #A37E58;
            transition: all 0.1s ease-in-out;
        }
        .btn-option:hover {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0px #A37E58;
        }
        .btn-option:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }
        .btn-correct {
            background-color: #A7C957;
            color: white;
            border-color: #6A994E;
            box-shadow: 3px 3px 0px #6A994E !important;
        }
        .btn-wrong {
            background-color: #E56B6F;
            color: white;
            border-color: #B56576;
            box-shadow: 3px 3px 0px #B56576 !important;
        }
        .speaker-btn {
            background-color: #FFC971;
            border: 2px solid #A37E58;
            box-shadow: 3px 3px 0px #A37E58;
            transition: all 0.1s ease-in-out;
        }
        .speaker-btn:hover {
            background-color: #FFB640;
        }
        .speaker-btn:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }
        .next-btn {
            background-color: #89B0AE;
            color: white;
            border: 2px solid #55828B;
            box-shadow: 3px 3px 0px #55828B;
        }
        .next-btn:hover {
            background-color: #79A09E;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div id="quiz-container" class="card w-full max-w-2xl p-6 md:p-8 rounded-2xl">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-amber-800">è¶Šå—è¯­æ‹¼å†™å¬åŠ›ç»ƒä¹ </h1>
            <p class="text-amber-700 mt-2">ç‚¹å‡»å–‡å­å›¾æ ‡å¬å•è¯ï¼Œç„¶åé€‰æ‹©æ­£ç¡®çš„æ‹¼å†™ã€‚</p>
            <p class="text-amber-700">(Nháº¥p vÃ o biá»ƒu tÆ°á»£ng loa Ä‘á»ƒ nghe tá»«, sau Ä‘Ã³ chá»n cÃ¡ch viáº¿t Ä‘Ãºng.)</p>
        </div>

        <!-- Quiz Area -->
        <div id="quiz-area">
            <div class="flex justify-between items-center mb-4">
                <div id="progress" class="text-lg font-semibold">é—®é¢˜ 1 / 100</div>
                <div id="score" class="text-lg font-semibold">åˆ†æ•°: 0</div>
            </div>

            <!-- Speaker Button -->
            <div class="flex justify-center my-8">
                <button id="speak-btn" class="speaker-btn p-4 rounded-full" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    </svg>
                </button>
            </div>

            <!-- Options -->
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <p class="text-center col-span-full">æ­£åœ¨åŠ è½½è¯­éŸ³å¼•æ“...</p>
            </div>
            
            <!-- Feedback -->
            <div id="feedback" class="text-center mt-6 text-xl font-bold h-8"></div>
            
            <!-- Next Button -->
            <div class="flex justify-center mt-4">
                <button id="next-btn" class="next-btn py-3 px-8 rounded-lg text-lg font-bold hidden">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>
        
        <!-- Result Screen -->
        <div id="result-screen" class="hidden text-center">
             <h2 class="text-3xl font-bold mb-4">åšå¾—å¥½ï¼</h2>
             <p id="final-score" class="text-2xl mb-6">ä½ çš„æœ€ç»ˆåˆ†æ•°æ˜¯ï¼š85 / 100</p>
             <button id="restart-btn" class="next-btn py-3 px-8 rounded-lg text-lg font-bold">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // --- 1. Cáº¥u hÃ¬nh vÃ  Dá»¯ liá»‡u ---
        const words = [
            'bÃ i bÃ¡o', 'trai gÃ¡i', 'sai trÃ¡i', 'mÃ¡y bay', 'cay cÃº', 'thay tháº¿', 'cháº¡y dÃ i', 'khÃ¢u vÃ¡', 'cháº­u thau', 'tráº§u cau',
            'mau láº¹', 'lÃ¢u nhÃ¢u', 'Ä‘áº§u trÃ¢u', 'nhÃ  láº§u', 'cÃ¢u cÃ¡', 'sÃ¢u xa', 'Ä‘au Ä‘áº§u', 'theo Ä‘uá»•i', 'giáº¥y tá»', 'tháº¥y rÃµ',
            'nhá» cáº­y', 'tháº§y giÃ¡o', 'táº¡i sao', 'cá»§a cáº£i', 'giÃ³ bá»¥i', 'vui chÆ¡i', 'lÃºi hÃºi', 'trá»¥i lÃ¹i', 'bá»‘i rá»‘i', 'HÃ  Ná»™i',
            'Ä‘Ã²i há»i', 'má»i nÆ¡i', 'soi tháº¥u', 'há»™i chá»£', 'chÆ¡i bá»i', 'chá» Ä‘á»£i', 'nghá»‰ ngÆ¡i', 'cá»©u chá»¯a', 'há»¯u nghá»‹', 'lÆ°u Ã½',
            'khÃ³ ngá»­i', 'gá»­i lá»i', 'hiu háº¯t', 'chá»‹u khÃ³', 'tiu nghá»‰u', 'lÃªu khÃªu', 'leo trÃ¨o', 'láº»o Ä‘áº»o', 'heo may', 'rau muá»‘ng',
            'Ä‘uÃ´i gÃ ', 'hÆ°Æ¡u nai', 'cÆ°á»i tÆ°Æ¡i', 'bÆ°á»Ÿi Ä‘Ã o', 'lÆ°á»¡i trai', 'ngÆ°á»i Ä‘á»i', 'yÃªu dáº¥u', 'nhiá»u Ä‘iá»u', 'yáº¿u Ä‘uá»‘i', 'phá»¥ ná»¯',
            'nghá» phá»¥', 'phÃ¹ há»£p', 'lá»‡ phÃ­', 'phá»Ÿ bÃ²', 'cháº¿ Ä‘á»™', 'che chá»Ÿ', 'chÃ¨ lÃ¡', 'va li', 'vÃ© sá»‘', 'vá»‡ sÄ©',
            'vi mÃ´', 'vÃ­ dá»¥', 'vá»‹ trÃ­', 'vÃ¬ tháº¿', 'tráº» thÆ¡', 'trÃ¬ trá»‡', 'trá»‹ giÃ¡', 'xá»© sá»Ÿ', 'nghá»‡ sÄ©', 'ká»µ sÄ©',
            'lo sá»£', 'sá»‘ Ä‘á»', 'sÆ¡ há»Ÿ', 'sÆ¡-mi', 'giáº£ vá»', 'giáº£ sá»­', 'kÃ½ giáº£', 'do dá»±', 'ra-Ä‘i-Ã´', 'ra-Ä‘a',
            'gia vá»‹', 'khÃ¡ giáº£', 'thi Ä‘ua', 'gÃ² ghá»', 'Ä‘i nháº¹', 'thá»© tá»±', 'thÆ° tá»«', 'tu bá»•', 'bÃ² dÃª', 'tá»‰ má»‰'
        ];

        // --- 2. Láº¥y cÃ¡c pháº§n tá»­ DOM ---
        const speakBtn = document.getElementById('speak-btn');
        const optionsContainer = document.getElementById('options-container');
        const feedbackEl = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');
        const progressEl = document.getElementById('progress');
        const scoreEl = document.getElementById('score');
        const quizArea = document.getElementById('quiz-area');
        const resultScreen = document.getElementById('result-screen');
        const finalScoreEl = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart-btn');

        // --- 3. Tráº¡ng thÃ¡i cá»§a á»©ng dá»¥ng ---
        let gameState = {
            shuffledWords: [],
            currentWordIndex: 0,
            score: 0,
            correctAnswer: '',
            voice: null,
        };

        // --- 4. CÃ¡c hÃ m chá»©c nÄƒng cá»‘t lÃµi ---

        /** Trá»™n má»™t máº£ng (thuáº­t toÃ¡n Fisher-Yates) */
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /** PhÃ¡t Ã¢m má»™t Ä‘oáº¡n vÄƒn báº£n */
        function speak(text) {
            if (!text || !gameState.voice) return;
            
            speechSynthesis.cancel(); // Há»§y cÃ¡c láº§n Ä‘á»c trÆ°á»›c
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.voice = gameState.voice;
            utterance.lang = gameState.voice.lang;
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
        }
        
        /** Táº¡o ra cÃ¡c Ä‘Ã¡p Ã¡n sai Ä‘á»ƒ gÃ¢y nhiá»…u */
        function generateDistractors(word) {
            // (Giá»¯ nguyÃªn logic táº¡o Ä‘Ã¡p Ã¡n sai vÃ¬ nÃ³ Ä‘Ã£ hoáº¡t Ä‘á»™ng tá»‘t)
            const distractors = new Set();
            const replacements = { 's': 'x', 'x': 's', 'tr': 'ch', 'ch': 'tr', 'd': 'gi', 'gi': 'd', 'r': 'd', 'l': 'n', 'n': 'l', 'i': 'y', 'y': 'i', 'au': 'Ã¢u', 'Ã¢u': 'au', 'ay': 'Ã¢y', 'Ã¢y': 'ay' };
            while (distractors.size < 3) {
                let newWord = word;
                for (const key in replacements) {
                    if (newWord.includes(key) && Math.random() > 0.5) {
                        newWord = newWord.replace(new RegExp(key, 'g'), replacements[key]);
                        if (newWord !== word) break;
                    }
                }
                if (newWord !== word) distractors.add(newWord);
            }
            return Array.from(distractors);
        }

        /** Hiá»ƒn thá»‹ cÃ¢u há»i hiá»‡n táº¡i lÃªn giao diá»‡n */
        function renderQuestion() {
            optionsContainer.innerHTML = '';
            feedbackEl.textContent = '';
            nextBtn.classList.add('hidden');
            
            gameState.correctAnswer = gameState.shuffledWords[gameState.currentWordIndex];
            
            const distractors = generateDistractors(gameState.correctAnswer);
            const options = shuffle([gameState.correctAnswer, ...distractors]);

            options.forEach(optionText => {
                const button = document.createElement('button');
                button.textContent = optionText;
                button.className = 'btn-option w-full p-4 rounded-lg text-xl';
                button.onclick = () => handleAnswer(optionText, button);
                optionsContainer.appendChild(button);
            });

            progressEl.textContent = `é—®é¢˜ ${gameState.currentWordIndex + 1} / ${words.length}`;
            scoreEl.textContent = `åˆ†æ•°: ${gameState.score}`;
        }

        /** Xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng chá»n má»™t Ä‘Ã¡p Ã¡n */
        function handleAnswer(selectedOption, buttonEl) {
            const allButtons = optionsContainer.querySelectorAll('button');
            allButtons.forEach(btn => btn.disabled = true);

            if (selectedOption === gameState.correctAnswer) {
                gameState.score++;
                buttonEl.classList.add('btn-correct');
                feedbackEl.textContent = 'æ­£ç¡®ï¼ ğŸ‰';
                feedbackEl.style.color = '#6A994E';
            } else {
                buttonEl.classList.add('btn-wrong');
                feedbackEl.innerHTML = `é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š<br><strong class="text-amber-800">${gameState.correctAnswer}</strong>`;
                feedbackEl.style.color = '#B56576';
                allButtons.forEach(btn => {
                    if (btn.textContent === gameState.correctAnswer) {
                        btn.classList.add('btn-correct');
                    }
                });
            }
            
            scoreEl.textContent = `åˆ†æ•°: ${gameState.score}`;
            nextBtn.classList.remove('hidden');
        }

        /** Chuyá»ƒn sang cÃ¢u há»i tiáº¿p theo hoáº·c káº¿t thÃºc game */
        function nextQuestion() {
            gameState.currentWordIndex++;
            if (gameState.currentWordIndex < words.length) {
                renderQuestion();
            } else {
                showResults();
            }
        }

        /** Hiá»ƒn thá»‹ mÃ n hÃ¬nh káº¿t quáº£ */
        function showResults() {
            quizArea.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            finalScoreEl.textContent = `ä½ çš„æœ€ç»ˆåˆ†æ•°æ˜¯ï¼š${gameState.score} / ${words.length}`;
        }
        
        /** Thiáº¿t láº­p láº¡i vÃ  báº¯t Ä‘áº§u má»™t lÆ°á»£t chÆ¡i má»›i */
        function startGame() {
            gameState.shuffledWords = shuffle([...words]);
            gameState.currentWordIndex = 0;
            gameState.score = 0;

            quizArea.classList.remove('hidden');
            resultScreen.classList.add('hidden');
            
            renderQuestion();
            speakBtn.disabled = false;
            
            // Tá»± Ä‘á»™ng Ä‘á»c tá»« Ä‘áº§u tiÃªn
            setTimeout(() => speak(gameState.correctAnswer), 300);
        }

        // --- 5. Logic Khá»Ÿi táº¡o ---

        /** HÃ m "giÃ¡m sÃ¡t" chá»§ Ä‘á»™ng kiá»ƒm tra giá»ng Ä‘á»c */
        function initializeSpeechSynthesis() {
            let voices = speechSynthesis.getVoices();

            // Náº¿u danh sÃ¡ch giá»ng Ä‘á»c chÆ°a cÃ³, tiáº¿p tá»¥c kiá»ƒm tra láº¡i sau 100ms
            if (voices.length === 0) {
                setTimeout(initializeSpeechSynthesis, 100);
                return;
            }
            
            // Æ¯u tiÃªn giá»ng vi-VN
            const desiredLangs = ['vi-VN', 'vi_VN'];
            let foundVoice = voices.find(v => desiredLangs.includes(v.lang));

            // Náº¿u khÃ´ng cÃ³, dÃ¹ng báº¥t ká»³ giá»ng tiáº¿ng Viá»‡t nÃ o, hoáº·c giá»ng Ä‘áº§u tiÃªn
            if (!foundVoice) {
                foundVoice = voices.find(v => v.lang.startsWith('vi')) || voices[0];
            }
            
            gameState.voice = foundVoice;
            console.log("Voice ready:", gameState.voice.name);
            
            // Chá»‰ khi Ä‘Ã£ cÃ³ giá»ng Ä‘á»c, má»›i báº¯t Ä‘áº§u trÃ² chÆ¡i
            startGame();
        }

        // --- 6. Gáº¯n cÃ¡c sá»± kiá»‡n ---
        speakBtn.addEventListener('click', () => speak(gameState.correctAnswer));
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', startGame);

        // --- 7. Báº¯t Ä‘áº§u á»©ng dá»¥ng ---
        // Báº¯t Ä‘áº§u quÃ¡ trÃ¬nh "giÃ¡m sÃ¡t" ngay khi trang Ä‘Æ°á»£c táº£i
        document.addEventListener('DOMContentLoaded', initializeSpeechSynthesis);

    </script>
</body>
</html>
