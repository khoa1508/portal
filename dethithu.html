<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H√°n Ng·ªØ S·ªë - Thi N√≥i</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f0f2f5; }
        .container { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; }
        input { padding: 10px; width: 80%; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        .status-box { padding: 20px; border: 2px dashed #ccc; margin-top: 20px; color: #666; }
        .recording { border-color: red; color: red; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="loginScreen" class="container">
        <h2>Ph√≤ng Thi N√≥i</h2>
        <p>Nh·∫≠p m√£ h·ªçc vi√™n gi√°o vi√™n cung c·∫•p</p>
        <input type="text" id="studentId" placeholder="V√≠ d·ª•: HV01">
        <br>
        <button onclick="joinRoom()">V√†o ph√≤ng ch·ªù</button>
    </div>

    <div id="waitingScreen" class="container hidden">
        <h2>‚è≥ ƒêang k·∫øt n·ªëi...</h2>
        <p>Xin ch√†o <b id="displayId"></b></p>
        <div class="status-box">
            ƒêang ƒë·ª£i t√≠n hi·ªáu m·ªü ƒë·ªÅ t·ª´ gi√°o vi√™n...<br>
            Vui l√≤ng kh√¥ng t·∫Øt tr√¨nh duy·ªát.
        </div>
    </div>

    <div id="examScreen" class="container hidden">
        <h2 style="color: #d9534f;">üî¥ ƒêANG THI N√ìI</h2>
        <div id="questionContent">
            <h3>ƒê·ªÅ b√†i: Gi·ªõi thi·ªáu b·∫£n th√¢n b·∫±ng ti·∫øng Trung (1 ph√∫t)</h3>
            </div>
        <div class="status-box recording">
            MIC ƒêANG M·ªû <br> (Gi·∫£ l·∫≠p ghi √¢m)
        </div>
    </div>

    <script type="module">
        // 1. IMPORT TH∆Ø VI·ªÜN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        // 2. C·∫§U H√åNH (THAY TH·∫æ B·∫∞NG TH√îNG TIN C·ª¶A B·∫†N)
        const firebaseConfig = {
            apiKey: "AIzaSyDcsk8X1rFd1qMd1W9510-ZKFlSfZUUKV8", // <--- COPY T·ª™ FIREBASE CONSOLE
            authDomain: "hannguso-exam.firebaseapp.com",
            databaseURL: "https://hannguso-exam-default-rtdb.asia-southeast1.firebasedatabase.app", // <--- COPY D√íNG N√ÄY CH√çNH X√ÅC
            projectId: "hannguso-exam",
            storageBucket: "hannguso-exam.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        // 3. KH·ªûI T·∫†O
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Bi·∫øn to√†n c·ª•c ƒë·ªÉ d√πng trong h√†m onclick
        window.joinRoom = function() {
            const sId = document.getElementById('studentId').value.trim();
            if(!sId) return alert("Vui l√≤ng nh·∫≠p M√£ h·ªçc vi√™n!");

            // Chuy·ªÉn m√†n h√¨nh
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('waitingScreen').classList.remove('hidden');
            document.getElementById('displayId').innerText = sId;

            // 4. L·∫ÆNG NGHE T√çN HI·ªÜU T·ª™ FIREBASE
            const studentRef = ref(db, 'students/' + sId + '/isOpen');
            
            onValue(studentRef, (snapshot) => {
                const isOpen = snapshot.val();
                console.log("Tr·∫°ng th√°i nh·∫≠n ƒë∆∞·ª£c:", isOpen);

                if (isOpen === true) {
                    // M·ªû KH√ìA
                    document.getElementById('waitingScreen').classList.add('hidden');
                    document.getElementById('examScreen').classList.remove('hidden');
                } else {
                    // KH√ìA L·∫†I (N·∫øu gi√°o vi√™n b·ªè t√≠ch)
                    document.getElementById('examScreen').classList.add('hidden');
                    document.getElementById('waitingScreen').classList.remove('hidden');
                }
            });
        };
    </script>
</body>
</html>
